<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit Converter</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    
    .converter-container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
    }
    
    h1 {
      font-size: 24px;
      color: #333;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    
    input, select, button {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    input:focus, select:focus {
      border-color: #007BFF;
      outline: none;
    }
    
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    button:active, .active {
      background-color: #0056b3 !important;
    }

    button:hover {
      background-color: #0056b3;
    }

    #result {
      margin-top: 20px;
      text-align: center;
    }
    
    #converted-value {
      font-size: 24px;
      font-weight: bold;
      color: #007BFF;
      white-space: pre-line; /* This will help preserve new lines (\n) in the result */
    }

    .toggle-btns {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }

    .toggle-btns button {
      width: 48%;
    }

  </style>
</head>
<body>
  <div class="converter-container">
    <h1>Unit Converter</h1>

    <div class="form-group">
      <label for="value">Value to convert:</label>
      <input type="number" id="value" placeholder="Enter value">
    </div>

    <div class="form-group">
      <label for="from-unit">From:</label>
      <select id="from-unit">
        <option value="">Select a unit</option>
      </select>
    </div>

    <div class="form-group">
      <label for="to-unit">To:</label>
      <select id="to-unit">
        <option value="">Select a unit</option>
      </select>
    </div>

    <div class="form-group">
      <label for="decimals">Decimals:</label>
      <input type="number" id="decimals" value="2">
    </div>

    <div class="toggle-btns">
      <button id="toggle-string" class="toggle-btn">Toggle String Mode</button>
      <button id="toggle-calculation" class="toggle-btn">Show Calculation</button>
    </div>

    <button id="convert-btn" style="margin-top: 10px;">Convert</button>

    <div id="result">
      <h2>Result: <span id="converted-value"></span></h2>
    </div>
  </div>

  <script type="module">
    import { Converter } from './src/js/Converter.js'; // Import the converter class

    const converter = new Converter();

    // Populate the "from" and "to" dropdowns with available units
    const unitMap = converter.getUnits();
    const fromSelect = document.getElementById('from-unit');
    const toSelect = document.getElementById('to-unit');

    // Flags to keep track of toggle states
    let showCalculation = false;
    let returnStringMode = false;
 
    // Populate options for units
    function populateUnits() {
      for (const type in unitMap) {
        unitMap[type].forEach(unit => {
          const option1 = document.createElement('option');
          option1.value = unit;
          option1.textContent = `${unit} (${type})`;

          const option2 = option1.cloneNode(true);

          fromSelect.appendChild(option1);
          toSelect.appendChild(option2);
        });
      }
    }

    // Run function to populate units dropdowns
    populateUnits();

    // Update button active state styling
    function toggleButton(button, isActive) {
      if (isActive) {
        button.classList.add('active');
      } else {
        button.classList.remove('active');
      }
    }

    // Toggle string mode
    document.getElementById('toggle-string').addEventListener('click', () => {
      returnStringMode = !returnStringMode;
      showCalculation = false; // Disable showCalculation when string mode is active
      converter.toggleStringMode(returnStringMode);
      converter.toggleShowCalculations(false);

      // Update button styles
      toggleButton(document.getElementById('toggle-string'), returnStringMode);
      toggleButton(document.getElementById('toggle-calculation'), showCalculation);
    });

    // Toggle show calculation mode
    document.getElementById('toggle-calculation').addEventListener('click', () => {
      showCalculation = !showCalculation;
      returnStringMode = false; // Disable string mode when showCalculation is active
      converter.toggleShowCalculations(showCalculation);
      converter.toggleStringMode(false);

      // Update button styles
      toggleButton(document.getElementById('toggle-calculation'), showCalculation);
      toggleButton(document.getElementById('toggle-string'), returnStringMode);
    });

    // Add event listener to the "Convert" button
    document.getElementById('convert-btn').addEventListener('click', () => {
      const value = document.getElementById('value').value;
      const fromUnit = document.getElementById('from-unit').value;
      const toUnit = document.getElementById('to-unit').value;
      const decimals = document.getElementById('decimals').value;

      if (!value || !fromUnit || !toUnit) {
        alert('Please fill in all fields!');
        return;
      }

      try {
        // Set the value and decimals
        converter.setValue(parseFloat(value));
        converter.setDecimals(parseInt(decimals));

        // Convert and display the result
        const result = converter.convert(fromUnit, toUnit);
        document.getElementById('converted-value').textContent = result;
      } catch (error) {
        alert(error.message);
      }
    });
  </script>
</body>
</html>
